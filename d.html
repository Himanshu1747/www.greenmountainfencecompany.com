---
import { queryWordPress } from "../../lib/wordpress";
import { getCollection } from "astro:content";
import BaseHead from "../../components/BaseHead.astro";
import Footer from "../../components/Footer.astro";
import FormattedDate from "../../components/FormattedDate.astro";
import Header from "../../components/Header.astro";
import { SITE_DESCRIPTION, SITE_TITLE } from "../../consts";

const posts = (await getCollection("blog")).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const BLOGQUERY = `
query blogpage {
   page(id: "blog", idType: URI){
    title
     featuredImage {
      node {
        mediaItemUrl
        altText
        fileSize
      }
    }
  }
}
`;
const pagedata = await queryWordPress(BLOGQUERY);
const finaldata = pagedata.page;

const MAIN_BLOGDATA = `
query MainBlog {
  posts(first: 100) {
    nodes {
      id
      title
      slug
      excerpt
	  date
      content
      featuredImage {
        node {
          mediaItemUrl
          altText
        }
      }
    }
  }
}
`;

const allblogpost = await queryWordPress(MAIN_BLOGDATA);
const alldatahere = allblogpost.posts.nodes;
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
	</head>
	<body>
		<Header />
		<section class="innerbanner-sec">
			<img
				src={finaldata?.featuredImage?.node?.mediaItemUrl || "error"}
				alt={finaldata?.title || "error"}
				title={finaldata?.title || "error"}
				width="1920"
				height="532"
				class="banner-image"
			/>
			<div class="container">
				<div class="allabout-banner">
					<h1 class="fs-80">{finaldata?.title || "error"}</h1>
				</div>
			</div>
		</section>
		<section class="blogmain-sec">
			<div class="container">
				<div class="grid-topblo">
					<div class="title-blogsss">
						<h2 class="fs-40 text-green">
							Green Mountain Fence Blogs
						</h2>
					</div>
					<div class="serach-filters">
						<div class="inputfilters">
							<input type="text" placeholder="search" />
							<button
								><img
									src="/search.png"
									alt=""
									height="20"
									width="20"
									loading="lazy"
								/></button
							>
						</div>
						<div class="clearall">
							<p>
								Clear <img
									src="/clear.png"
									alt="image"
									height="20"
									width="20"
									loading="lazy"
								/>
							</p>
						</div>
					</div>
				</div>
				<div class="blog-grids">
					{
						[...alldatahere].map((blogitems) => {
							return (
								<div class="blog-holders">
									<a
										href={`/blog/${blogitems.slug}`}
										title={blogitems.title || "error"}
									>
										<div class="main-ima">
											<img
												src={
													blogitems?.featuredImage
														?.node?.mediaItemUrl ||
													"error"
												}
												alt={blogitems.title || "error"}
												height="347"
												width="495"
												loading="lazy"
											/>
										</div>
									</a>
									<div class="bootm-data">
										<p class="date">
											{blogitems?.date
												? new Date(
														blogitems.date,
													).toLocaleDateString(
														"en-GB",
													)
												: "error"}
										</p>
										<h6 class="fs-20">
											{blogitems.title || "error"}
										</h6>
										<div
											set:html={
												blogitems?.excerpt || "error"
											}
										/>
										<div class="grid-readmore">
											<div class="read-button">
												<a
													href={`/blog/${blogitems.slug}`}
													title="Read More »"
												>
													Read More »
												</a>
											</div>
											<div
												class="sharenow share-button"
												style="cursor: pointer;"
												data-title={blogitems.title}
												data-url={`/blog/${blogitems.slug}`}
											>
												<img
													src="/share-icon.png"
													alt={
														blogitems.title ||
														"error"
													}
													height="20"
													width="20"
													loading="lazy"
												/>
											</div>
										</div>
									</div>
								</div>
							);
						})
					}
				</div>
			</div>
		</section>
		<Footer />

		<style>
			.inputfilters input {
				border: none;
			}

			.inputfilters button {
				background: transparent;
				border: none;
				max-width: 25px;
				width: 25px;
				padding: 0;
			}
			.inputfilters {
				display: flex;
				max-width: 200px;
				width: 100%;
				border: 1px solid var(--color-black);
				padding: 5px 10px;
			}

			.serach-filters {
				display: flex;
				align-items: center;
				gap: 20px;
			}

			.serach-filters p {
				padding: 0;
			}

			.grid-topblo {
				display: flex;
				justify-content: space-between;
				gap: 20px;
				flex-wrap: wrap;
				padding-bottom: 70px;
			}
			section.blogmain-sec {
				padding: 75px 0px;
			}

			.inputfilters img {
				height: 20px;
				width: 20px;
			}
			@media (max-width: 1600px) {
				section.blogmain-sec {
					padding: 60px 0px;
				}
				.grid-topblo {
					padding-bottom: 50px;
				}
			}
			@media (max-width: 1199px) {
				section.blogmain-sec {
					padding: 50px 0px;
				}
			}
			@media (max-width: 991px) {
				
				.grid-topblo {
					padding-bottom: 40px;
					flex-direction: column;
				}
			}
			@media (max-width: 767px) {
				
				.blog-holders {
					max-width: 350px;
				}
			}
		</style>

		<script>
			const shareButtons = document.querySelectorAll(".share-button");

			shareButtons.forEach((button) => {
				button.addEventListener("click", async () => {
					const title = button.getAttribute("data-title");
					const url =
						window.location.origin +
						button.getAttribute("data-url");

					if (navigator.share) {
						try {
							await navigator.share({
								title: title,
								text: `Check this out: ${title}`,
								url: url,
							});
							console.log("Shared successfully");
						} catch (err) {
							console.log("Error sharing:", err);
						}
					} else {
						// Fallback: If browser doesn't support Web Share (like some desktop browsers)
						try {
							await navigator.clipboard.writeText(url);
							alert("Link copied to clipboard!");
						} catch (err) {
							console.error("Failed to copy: ", err);
						}
					}
				});
			});
		</script>
	</body>
</html>
