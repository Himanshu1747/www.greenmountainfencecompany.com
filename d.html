<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Document</title>
</head>
<body>
	
            <section class="review-data">
                <div class="container">
                    <div
                        id="indexReviewsWidget"
                        data-merchant="51664"
                        data-header-adjective="satisfied"
                        data-header-noun="customers"
                        data-write-disable="false"
                    >
                    </div>
                </div>
            </section>
        </main>

        <script is:inline>
            (function () {
                function injectWidget() {
                    const container =
                        document.getElementById("indexReviewsWidget");
                    if (!container) return;

                    // Clean up previous attempts
                    const oldScript = document.getElementById(
                        "survly-script-loader",
                    );
                    if (oldScript) oldScript.remove();

                    const script = document.createElement("script");
                    script.id = "survly-script-loader";
                    // Adding a timestamp cache-buster to ensure a fresh fetch
                    script.src =
                        "https://survlywidget.firebaseapp.com/static/js/index.js?v=" +
                        new Date().getTime();
                    script.async = true;

                    script.onload = () => {
                        console.log(
                            "Survly script loaded. Attempting render...",
                        );
                        // Poll for the render function in case of slow execution
                        let attempts = 0;
                        const checkRender = setInterval(() => {
                            if (typeof window.renderApp === "function") {
                                window.renderApp();
                                clearInterval(checkRender);
                                console.log("Widget Rendered Successfully");
                            }
                            if (attempts > 20) clearInterval(checkRender); // Stop after 2 seconds
                            attempts++;
                        }, 100);
                    };

                    document.body.appendChild(script);
                }

                // Run on initial load
                if (document.readyState === "complete") {
                    injectWidget();
                } else {
                    window.addEventListener("load", injectWidget);
                }

                // Run on Astro navigation
                document.addEventListener("astro:page-load", injectWidget);
                document.addEventListener("astro:after-swap", injectWidget);
            })();
        </script>
</body>
</html>