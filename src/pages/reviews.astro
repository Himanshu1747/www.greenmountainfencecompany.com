---
import { queryWordPress } from "../lib/wordpress";
import BaseHead from "../components/BaseHead.astro";
import Header from "../components/Header.astro";

const REVIEW_DATA = `
query Reviewpage {
  page(id: "reviews", idType: URI) {
    title
    seo {
      canonical
      cornerstone
      fullHead
    }
    featuredImage {
      node {
        mediaItemUrl
        altText
      }
    }
  }
}
`;

const pagedata = await queryWordPress(REVIEW_DATA);
const finaldata = pagedata?.page || {};
const seodata = finaldata?.seo || {};
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead
            useYoast={true}
            canonical={seodata?.canonical || ""}
            focuskw={seodata?.focuskw || ""}
        />
        {seodata?.fullHead && <Fragment set:html={seodata.fullHead} />}
    </head>
    <body>
        <Header />

        <section class="innerbanner-sec">
            <img
                src={finaldata?.featuredImage?.node?.mediaItemUrl || ""}
                alt={finaldata?.featuredImage?.node?.altText || finaldata?.title || ""}
                title={finaldata?.title || ""}
                width="1920"
                height="532"
                loading="eager"
                fetchpriority="high"
                class="banner-image"
            />
            <div class="container">
                <div class="allabout-banner">
                    <h1 class="fs-80">{finaldata?.title || ""}</h1>
                </div>
            </div>
        </section>

        <section class="review-data">
            <div class="container">
                <div
                    id="indexReviewsWidget"
                    data-merchant="51664"
                    data-header-adjective="satisfied"
                    data-header-noun="customers"
                    data-write-disable="false"
                >
                </div>
            </div>
        </section>

        <script 
            is:inline 
            async 
            src="https://survlywidget.firebaseapp.com/static/js/index.js"
            onload="if(typeof renderApp === 'function'){ renderApp(); }"
        ></script>

        <style>
            section.review-data {
                padding: 40px 0px;
                min-height: 400px; /* Prevents layout shift while widget loads */
            }
        </style>
    </body>
</html>