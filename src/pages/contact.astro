---
import BaseHead from "../components/BaseHead.astro";
import { queryWordPress } from "../lib/wordpress";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import Testimonial from "../components/Testimonial.astro";
import Contactform from "../components/Contactform.astro";

/** * HIGH SPEED CACHING STRATEGY
 * Replaced no-cache with SWR for instant 0ms delivery
 */
Astro.response.headers.set(
  'Cache-Control',
  'public, s-maxage=120, stale-while-revalidate=30'
);

const CONTACTQUERY = `
query Contactus {
  page(id: "contact", idType: URI) {
    title
    seo { canonical cornerstone fullHead }
    contactUs {
      getConnectTittle
      contactFormTitle
      contactDetails {
        iconImage {
          node { mediaItemUrl altText }
        }
        detailsContacts
      }
      backgroundImage {
        node { mediaItemUrl altText }
      }
    }
    featuredImage {
      node { mediaItemUrl altText }
    }
  }
}
`;

const pagedata = await queryWordPress(CONTACTQUERY);
const finaldata = pagedata?.page || {};
const seodata = finaldata?.seo || {};
const bannerUrl = finaldata?.featuredImage?.node?.mediaItemUrl || "";
const bgContactUrl = finaldata?.contactUs?.backgroundImage?.node?.mediaItemUrl || "";
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead
            useYoast={true}
            canonical={seodata?.canonical || ""}
            focuskw={seodata?.focuskw || ""}
        />
        {seodata?.fullHead && <Fragment set:html={seodata.fullHead} />}
        
        {/* SPEED: Preload LCP Banner */}
        {bannerUrl && <link rel="preload" as="image" href={bannerUrl} fetchpriority="high" />}
    </head>
    <body>
        <Header />

        <section class="innerbanner-sec">
            <img
                src={bannerUrl}
                alt={finaldata?.featuredImage?.node?.altText || finaldata?.title || ""}
                width="1920"
                height="532"
                loading="eager"
                fetchpriority="high"
                decoding="sync"
                class="banner-image"
                style="aspect-ratio: 1920 / 532; object-fit: cover;"
            />
            <div class="container">
                <div class="allabout-banner">
                    <h1 class="fs-80">{finaldata?.title || ""}</h1>
                </div>
            </div>
        </section>

        <section class="getconnect-sec">
            <div class="container">
                <div class="center-data">
                    <h2 class="fs-40 text-green">
                        {finaldata?.contactUs?.getConnectTittle || ""}
                    </h2>
                </div>
                <div class="grid-details">
                    {
                        finaldata?.contactUs?.contactDetails?.map((items) => (
                            <div class="details-holders">
                                <img
                                    src={items?.iconImage?.node?.mediaItemUrl || ""}
                                    alt={items?.iconImage?.node?.altText || "icon"}
                                    class="icon-image"
                                    loading="lazy"
                                    decoding="async"
                                    width="50" 
                                    height="50"
                                />
                                <div set:html={items?.detailsContacts || ""} />
                            </div>
                        ))
                    }
                </div>
            </div>
        </section>

        <section class="contact-sec">
            {/* Background Image Optimization: fetchpriority low to prioritize the form */}
            <img
                src={bgContactUrl}
                alt="background"
                width="1920"
                height="960"
                loading="lazy"
                decoding="async"
                fetchpriority="low"
                class="banner-image"
                style="aspect-ratio: 1920 / 960; object-fit: cover;"
            />
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-6">
                        <div class="about-contact">
                            <h2 class="fs-60">
                                {finaldata?.contactUs?.contactFormTitle || ""}
                            </h2>
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="main-formholders">
                             <Contactform/>
                        </div>
                    </div>
                </div>
            </div>
        </section>

         <Testimonial client:visible />
        <Footer />

        <style is:inline>
            .banner-image { width: 100%; height: auto; display: block; }
            .details-holders { max-width: 477px; width: 100%; text-align: center; }
            .icon-image { max-width: fit-content; margin: 0 auto 20px; aspect-ratio: 1/1; }
            .center-data { max-width: fit-content; margin: 0 auto; text-align: center; width: 100%; }
            .grid-details { display: flex; flex-wrap: wrap; justify-content: center; column-gap: 30px; row-gap: 30px; padding-top: 75px; }
            section.getconnect-sec { padding: 75px 0px; }
            .details-holders a { word-break: break-word; overflow-wrap: break-word; }
            section.contact-sec { position: relative; z-index: 1; width: 100%; overflow: hidden; color: var(--color-white); padding: 55px 0px; }
            section.contact-sec .banner-image { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; filter: brightness(0.5); }
            .about-contact { max-width: 587px; width: 100%; }
            @media (max-width: 1600px) { .icon-image { max-width: 40px; } section.getconnect-sec { padding: 60px 0px; } .grid-details { padding-top: 50px; } }
            @media (max-width: 1400px) { section.getconnect-sec { padding: 40px 0px; } .grid-details { padding-top: 30px; gap: 30px; } section.contact-sec { padding: 40px 0px; } }
            @media (max-width: 991px) { .about-contact { text-align: center; max-width: 100%; margin: 0 auto; } }
        </style>
    </body>
</html>